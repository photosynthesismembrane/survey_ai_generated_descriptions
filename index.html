<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
    body {
        font-family: Helvetica, Arial, sans-serif;
        background-color: #f9f9f9;
        color: #333;
        line-height: 1.6;
        padding: 20px;
    }
    .tab {
        display: none; /* Hide tabs initially */
    }
    .tab.mobile {
        width: 100%; /* Full width for mobile */
        /* Increase font size for better readability on mobile */
        h2 {
            font-size: 48px;
        }
        h3 {
            font-size: 32px;
        }
        label {
            font-size: 24px;
        }
    }
    .visible {
        display: block; /* Only the active tab is visible */
    }
    #tabContainer {
        display: flex;
        flex-direction: column;
        align-items: center; /* This centers the child elements horizontally */
        width: 100%; /* Ensures the container takes full width */
    }
    .text-field-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        padding: 20px;
        box-sizing: border-box;
    }
    .text-field-container.non-mobile {
        max-width: 50vw; /* Limit width for desktop */
    }
    .text-field-container.mobile {
        max-width: 100vw; /* Full width for mobile */
    }
    .form-group {
        display: flex;
        align-items: center; /* Ensures labels are aligned with the text fields */
        justify-content: space-between;
        margin-bottom: 15px;
        width: 100%;
        max-width: 600px;
    }

    .form-group label {
        width: 50%;
        text-align: right;
        margin-right: 10px;
        font-size: 16px;
    }

    .form-group input {
        width: 65%;
        padding: 8px;
        font-size: 16px;
    }
    .item {
        display: flex; /* This will align the image and text side by side */
        align-items: center; /* This will vertically align items in the middle */
        justify-content: center; /* Aligns items to the start of the 'item' container */
        margin-bottom: 20px;
        max-width: 100%;
        padding: 40px;
    }
    .item.mobile {
        flex-direction: column; /* Stack image and text on top of each other */
        .text-content-container-mobile {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
    }
    .item.mobile.odd {
        background-color: #f9f9f9;
    }
    img {
        width: auto; /* Auto width for responsive size */
        max-height: 80vh;
        max-width: 25vw;
        border: 1px solid #ccc;
    }
    img.mobile {
        max-width: 100%; /* Full width for mobile */
        max-height: 60vh; /* Half height for mobile */
    }
    .text-content {
        display: flex; /* This will align the image and text side by side */
        align-items: center; /* This will vertically align items in the middle */
        justify-content: center; /* Aligns items to the start of the 'item' container */
        padding: 40px;
        margin: 20px; /* Space between image and text */
        width: 30vw;
        height: 60vh;
        background-color: #fff;
        border: 1px solid #ddd;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        border-radius: 8px;
    }
    .text-content.mobile {
        height: 35vh; /* Full height for mobile */
        width: 40vw; /* Full width for mobile */
    }
    input[type="radio"], textarea, button {
        margin-right: 5px;
        margin-top: 20px;
    }
    label {
        margin-right: 10px;
        font-size: 16px;
    }
    .text-field-container {
        text-align: left;
    }
    textarea {
        width: 80%; /* Adequate width for writing a paragraph */
        height: 100px; /* Enough height to write multiple lines */
        margin: 20px auto; /* Center align the textarea */
        display: block; /* Ensures that textarea takes its own line */
    }
    .controls {
        text-align: center; /* Center-aligns buttons */
        padding: 10px;
    }
    button {
        font-size: 16px;
        padding: 10px;
        margin: 10px; /* Space between buttons */
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background-color: #45a049;
    } 
    button.mobile {
        font-size: 32px; /* Increase font size */
        padding: 20px; /* Increase padding for better touch target */
        margin: 20px; /* Space between buttons */
    }
    /* Important Button */
    button.important {
        font-size: 18px;
        padding: 12px;
        margin: 10px; /* Space between buttons */
        background-color: #5BC85C;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    button.important:hover {
        background-color: #4CAF50;
    }
    button.mobile.important {
        font-size: 36px;
        padding: 24px;
        margin: 20px; /* Space between buttons */
        box-shadow: 0 48x 16px rgba(0, 0, 0, 0.2);
    }
    .selected {
        background-color: #e7f4e4; /* Subtle light green background for selected text blocks */
    }
    .header-container {
        text-align: center;
        margin-bottom: 20px;
    }
    .highlighted {
        background-color: #ffb7b7;
        cursor: pointer;
    }
    /* Modal styles */
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgb(0,0,0); 
        background-color: rgba(0,0,0,0.4); 
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; 
        padding: 20px;
        border: 1px solid #888;
        width: 80%; 
        max-width: 600px;
        text-align: center;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #mobileMessage {
        display: none;
        font-size: 32px; /* Increase font size */
        text-align: center; /* Center align text */
        padding: 30px; /* Add padding for better readability */
        background-color: #f8d7da; /* Light red background for visibility */
        color: #721c24; /* Dark red text color for contrast */
        border: 1px solid #f5c6cb; /* Border to match the background color */
        border-radius: 5px; /* Rounded corners for better appearance */
        margin: 20px; /* Margin around the message */
    }

        /* Dropdown styling */
        .dropdown-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
            width: 20vw;
        }
        .dropdown-container.mobile {
            width: 60vw;
            select {
                font-size: 24;
            }
        }
        select {
            width: 200px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            font-size: 16px;
            cursor: pointer;
            appearance: none; /* Remove default arrow */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'16\' height=\'16\'%3e%3cpath fill=\'%23666\' d=\'M7 10l5-5H2z\'/%3e%3c/svg%3e');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 10px;
        }
        select:hover {
            border-color: #4caf50;
        }
        .small-image-container {
            display: flex;
            justify-content: left;
            align-items: center;
            margin-bottom: 20px;
            label {
                width: 100px;
            }
            img {
                width: 50px;
                height: 50px;
                border: 1px solid #ccc;
            }
        }
        .small-image-container.mobile {
            label {
                width: 200px;
            }
            img {
                width: 100px;
                height: 100px;
            }
        }
        .dataset-container {
            display: flex;
            margin-bottom: 20px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .word {
            cursor: pointer;
            display: inline; /* Ensure the spans display inline */
            white-space: pre-wrap; /* Preserve whitespace for wrapping */
        }
</style>
<script src="renaissance_data.js"></script>
<script src="pinterest_data.js"></script>
</head>
<body>
    <div id="mobileMessage" style="display:none;">
        <p>The survey is made to run on a desktop or laptop. The interface does not work on a mobile phone. Please find the opportunity to open the link on a desktop or laptop.</p>
        <br/>
        <p>Link:</p>
        <p>https://photosynthesismembrane.github.io/survey/</p>
    </div>
    <form action="https://formcarry.com/s/TdcsLuZb9Vh" method="POST">
        <div id="tabContainer"></div>
    </form>
    <script>
        image_data = renaissance_data;
        image_folder = "renaissance";
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                // Generate a random index from 0 to i
                const j = Math.floor(Math.random() * (i + 1));
                // Swap elements at indices i and j
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function changeDataSource() {
            const dataSource = document.getElementById('data-source').value;
            if (dataSource === 'pinterest') {
                image_folder = 'images';
                image_data = pinterest_data;
            } else if (dataSource === 'renaissance') {
                image_folder = 'renaissance';
                image_data = renaissance_data;
            }
            displayTabs(initially = false);
        }


        function shuffleTupleArray(array) {
            const shuffledArray = array.slice();
            for (let i = shuffledArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]];
            }
            return shuffledArray;
        }

        const tuples = [
            ["llava", "cogvlm"],
            ["llava", "deepseek"],
            ["cogvlm", "deepseek"]
        ];

        function shuffleModelsArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        const models = [
            "llava",
            "deepseek",
            "cogvlm",
        ];

        const tabInfo = [
            {
                title: "Composition",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "composition",
                questions: [
                    "Judge which <strong>text</strong> you find describes the <strong>composition</strong> of the painting the best. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on <strong>composition</strong> of these paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Contrast",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "contrast_elements",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes the use of <strong>contrast</strong> in the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> about how <strong>contrast</strong> is used of these paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Foreground & Background",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "foreground_background_4",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes the relationship between <strong>foreground and background</strong> in the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on <strong>foreground and background</strong> of these paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Symmetry & Asymmetry",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "symmetry_asymmetry_1",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes <strong>symmetry and asymmetry</strong> in the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on <strong>symmetry and asymmetry</strong> of these paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Eye Movement",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "eye_movement_2",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes how the viewers <strong>eye movement</strong> is guided through the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on the viewers <strong>eye movement</strong> for the paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Focus Point",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "focus_point",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes the <strong>focus point</strong> of the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on the <strong>focus point</strong> of the paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Balance",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "balance_elements",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes <strong>balance</strong> between the elements in the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on <strong>balance</strong> between the elements in the paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            },
            {
                title: "Proportion",
                subtitle: ["Judge which description fits best", "Highlight non fitting parts in the text"],
                data: "proportion",
                questions: [
                    "Judge which <strong>text</strong> you find that bests describes use of <strong>proportion</strong> of the painting. Click to select the most fitting description.",
                    "Judge the quality of the <strong>text</strong> on use of <strong>proportion</strong> of the paintings. Do this by highlighting parts of the texts that you think are not fitting or could be improved."
                ]
            }
        ];

        function truncateText(text, maxChars) {
            if (text.length <= maxChars) {
                return text;
            }
            let truncated = text.substring(0, maxChars);
            const lastSentenceEnd = Math.max(truncated.lastIndexOf('.'), truncated.lastIndexOf('!'), truncated.lastIndexOf('?'));
            if (lastSentenceEnd > -1) {
                truncated = truncated.substring(0, lastSentenceEnd + 1);
            } else {
                truncated = truncated.substring(0, truncated.lastIndexOf(' '));
            }
            return truncated.trim();
        }

        /** 
         * Returns the html that displays a random image selection
         * All the images are shown very small
        */
        function showRandomImageSelection(label, img_data, img_folder) {
            let img_keys = Object.keys(img_data);
            shuffleArray(img_keys);
            let img_html = '';
            mobile = window.mobileAndTabletCheck() ? 'mobile' : 'non-mobile';
            for (let i = 0; i < 6; i++) {
                let img_key = img_keys[i];
                let img_text = img_data[img_key];
                img_html += `<img class="small ${mobile}" src="${img_folder}/${img_key}" alt="${img_key}">`;
            }
            return `<div class="small-image-container ${mobile}">
                        <label>${label}</label>
                        ${img_html}
                    </div>`;
        }

        function createIntroTab() {
            mobile = window.mobileAndTabletCheck() ? 'mobile' : 'non-mobile';
            return `
                <div class="tab visible ${mobile}" id="tab0">
                    <div class="header-container">
                        <h2>Welcome to the Survey</h2>
                    </div>
                    <div class="text-field-container">
                        <p>Thank you for participating. I'm Tom Eijkelenkamp and I study Computing Science: Intelligent Systems and Visual Computing at the University of Groningen. I have a fascination for any kind of art form and so for my thesis I study AI art. The research is based around composition of generated art.</p>
                        <p>I used several ai vision language models to describe the composition of paintings. Data as such I use to train an ai art generator for further research. I'm interested in your opinion on the quality of the descriptions.</p>
                        <p>One part of the survey you are asked to select which of the two descriptions fits best. Another part is that you are asked to highlight parts of the text that you think are not fitting or could be improved. Each tab shows descriptions on a specific topic.</p>
                        <p>You receive 10 euros for participating. When there are more then 50 participants, we will randomly select 50 participants to receive 10 euros. The survey takes about 20 minutes to complete. Filling in the personal details is not mandatory. Please leave your email and we will contact you to send you the money.</p>
                    </div>
                    <div class="text-field-container">
                        <h3>Please fill in your personal information:</h3>
                        <div class="form-group">
                            <label for="name">Name:</label>
                            <input type="text" id="name" name="name">
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="art_education">Describe in short your experience in art:</label>
                            <input type="text" id="art_education" name="art_education">
                        </div>
                        <input type="hidden" id="ip-address" name="ip">
                        <input type="hidden" id="country" name="country">
                    </div>
                    <br/>
                    <div class="text-field-container">
                        <p>I gathered two sets of artworks from the web. There is one set of paintings from the renaissance which I selected from the WikiArt dataset. There is another set of illustrations that I gathered from Pinterest. You can choice for which set you want to do the survey:</p>
                    </div>
                    <div class="dataset-container">
                        <div class="dropdown-container ${mobile}">
                            <select id="data-source" onchange="changeDataSource()">
                                <option value="renaissance">Renaissance</option>
                                <option value="pinterest">Pinterest</option>
                            </select>
                        </div>`
                        + showRandomImageSelection('Renaissance:', renaissance_data, 'renaissance')
                        + showRandomImageSelection('Pinterest:', pinterest_data, 'images') +
                        `
                    </div>
                    <div class="text-field-container">
                        <p>By joining the survey you give consent to the use of your input in an ananyomous manner for this scientific study. You have the right to withdraw from the study at any time, even after completion of the survey.</p>
                        <p>If you have questions or remarks send an email to: t.eijkelenkamp@student.rug.nl</p>
                    </div>
                    <div class="controls">
                        <button type="button" class="important ${mobile}" onclick="changeTab(0, 1)">Start</button>
                    </div>
                </div>
            `;
        }


        function createOutroTab(tabIndex) {
            mobile = window.mobileAndTabletCheck() ? 'mobile' : 'non-mobile';
            return `
                <div class="tab ${mobile}" id="tab${tabIndex}">
                    <div class="header-container">
                        <h2>We appreciate your insights. Thank you for sharing your thoughts with us.</h2>
                        <p>Click submit to finish the survey!</p>
                    </div>
                    <div class="controls">
                        <button type="button" class="${mobile}" onclick="changeTab(${tabIndex}, -1)">Previous</button>
                        <button type="submit" class="important ${mobile}">Submit</button>
                    </div>
                </div>
            `;
        }

        function createTabContent(tabIndex, items, two_options) {
            let tabInfoItem = tabInfo[Math.ceil(tabIndex / 2)]; 
            let mobile = window.mobileAndTabletCheck() ? 'mobile' : 'non-mobile';
            let tabContent = `<div class="tab ${mobile}" id="tab${tabIndex}">`;
            tabContent += `<div class="header-container"><h2>(${tabIndex}/4) ${tabInfoItem.title}</h2><h3>${tabInfoItem.subtitle[two_options ? 0 : 1]}</h3><p>${tabInfoItem.questions[two_options ? 0 : 1]}</p></div>`;
            if (two_options) {
                const shuffledTuples = shuffleTupleArray(tuples);
                items.forEach((item, index) => {
                    const [firstComposition, secondComposition] = shuffledTuples[index % shuffledTuples.length];
                    const text_one = truncateText(image_data[item][`${firstComposition}_answers`][tabInfoItem.data], 1000);
                    const text_two = truncateText(image_data[item][`${secondComposition}_answers`][tabInfoItem.data], 1000);
                    if (mobile === 'non-mobile') {
                        tabContent += `
                            <div class="item ${mobile}">
                                <input type="hidden" name="${tabInfoItem.data}_${item}" value="">
                                <div class="text-content ${mobile} two-option-text-content" data-index="${firstComposition}" onclick="toggleSelection(event)">
                                    <span>${text_one}</span><br>
                                </div>
                                <img src="${image_folder}/${item}" class="${mobile}" alt="${item}">
                                <div class="text-content ${mobile} two-option-text-content" data-index="${secondComposition}" onclick="toggleSelection(event)">
                                    <span>${text_two}</span><br>
                                </div>
                            </div>
                        `;
                    } else {
                        odd_even = index % 2 === 0 ? 'even' : 'odd';
                        tabContent += `
                            <div class="item ${mobile} ${odd_even}">
                                <input type="hidden" name="${tabInfoItem.data}_${item}" value="">
                                <img src="${image_folder}/${item}" class="${mobile}" alt="${item}">
                                <div class="text-content-container-mobile">
                                    <div class="text-content ${mobile} two-option-text-content" data-index="${firstComposition}" onclick="toggleSelection(event)">
                                        <span>${text_one}</span><br>
                                    </div>
                                    <div class="text-content ${mobile} two-option-text-content" data-index="${secondComposition}" onclick="toggleSelection(event)">
                                        <span>${text_two}</span><br>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
            } else {
                const shuffledModels = shuffleModelsArray(models);
                items.forEach((item, index) => {
                    const model = shuffledModels[index];
                    const text = truncateText(image_data[item][`${model}_answers`][tabInfoItem.data], 1000);
                    tabContent += `
                        <div class="item">
                            <img src="${image_folder}/${item}" alt="${item}">
                            <div class="text-content  ${mobile} highlight-text-content" id="${model}_${tabInfoItem.data}_${item}">
                                <span>${text}</span>
                            </div>
                            <input type="hidden" class="input-highlights" id="highlights_${model}_${tabInfoItem.data}_${item}" name="highlights_${model}_${tabInfoItem.data}_${item}">
                        </div>
                    `;
                });
            }
            tabContent += `
                <div class="controls">
                    <button type="button" class="${mobile}" onclick="changeTab(${tabIndex}, -1)">Previous</button>
                    <button type="button" class="${mobile}" onclick="changeTab(${tabIndex}, 1)">Next</button>
                </div>                
            `;
            tabContent += `<input type="hidden" id="time_spent_tab${tabIndex}" name="time_spent_tab${tabIndex}" value="">`;
            tabContent += `</div>`;
            return tabContent;
        }
        
        function toggleSelection(event) {
            const textContent = event.currentTarget;
            const allTextContents = textContent.parentNode.querySelectorAll('.two-option-text-content');
            const allInvisibleInputs = textContent.parentNode.querySelectorAll('input[type="hidden"]');
            allTextContents.forEach(block => {
                if (block !== textContent) {
                    block.classList.remove('selected');
                }
            });
            allInvisibleInputs.forEach(input => {
                input.value = "";
            });
            textContent.classList.add('selected');
            const input = textContent.parentNode.querySelector('input[type="hidden"]');
            input.value = textContent.getAttribute('data-index');
            let parentItem = textContent.closest('.item');
            let nextItem = parentItem.nextElementSibling;
            if (nextItem && nextItem.classList.contains('item')) {
                scrollToItem(nextItem);
            } else {
                scrollToBottom();
            }
        }

        function addHighlightListeners() {
            const highlightedElements = document.querySelectorAll('.highlight-text-content');

            highlightedElements.forEach(function(element) {
                element.highlights = [];

                // Mouse events for desktop
                element.addEventListener('mouseup', function() {
                    handleTextSelection(element);
                });

                // Touch events for mobile
                document.addEventListener('touchend', function() {
                    handleTextSelection(element);
                });
            });
        }

        function handleTextSelection(element) {
            let selection = null;
            if (window.getSelection) {
                selection = window.getSelection();
            } else if (document.selection && document.selection.type !== "Control") {
                selection = document.selection.createRange();
            }

            if (selection && !selection.isCollapsed && selection.toString().trim() !== '') {
                const range = selection.getRangeAt(0);
                const selectionContents = range.extractContents();
                const span = document.createElement('span');
                span.classList.add('highlighted');
                span.appendChild(selectionContents);

                range.deleteContents();
                range.insertNode(span);

                span.addEventListener('click', function() {
                    removeHighlight(span, element);
                });

                element.highlights.push(span.textContent);
                updateHighlightsInput(element);

                selection.removeAllRanges();
            }
        }

        function removeHighlight(span, element) {
            const index = element.highlights.indexOf(span.textContent);
            if (index > -1) {
                element.highlights.splice(index, 1);
            }
            const textNode = document.createTextNode(span.textContent);
            span.parentNode.replaceChild(textNode, span);
            updateHighlightsInput(element);
        }

        function updateHighlightsInput(element) {
            const highlightsInput = document.getElementById(`highlights_${element.id}`);
            if (highlightsInput) {
                highlightsInput.value = element.highlights.join(' | ');
            }
        }

        function attachScrollToNextItem() {
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(button => {
                button.addEventListener('change', function() {
                    let parentItem = this.closest('.item');
                    let nextItem = parentItem.nextElementSibling;
                    if (nextItem && nextItem.classList.contains('item')) {
                        scrollToItem(nextItem);
                    } else {
                        scrollToBottom();
                    }
                });
            });
        }

        function scrollToItem(item) {
            const yOffset = -window.innerHeight / 2 + item.clientHeight / 2;
            const yPosition = item.getBoundingClientRect().top + window.pageYOffset + yOffset;
            window.scrollTo({ top: yPosition, behavior: 'smooth' });
        }

        function scrollToBottom() {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        let tabEnterTime = new Date().getTime();
        let tabTimeData = Array(14).fill().map(() => []); // Initialize for 14 tabs (0 to 13)

        function recordTimeSpent(tabIndex) {
            const now = new Date().getTime();
            if (tabEnterTime) {
                const timeSpent = now - tabEnterTime;
                tabTimeData[tabIndex].push(timeSpent);
            }
            tabEnterTime = now;
        }

        function storeTimeData() {
            for (let i = 0; i <= 13; i++) {
                const timeField = document.getElementById(`time_spent_tab${i}`);
                if (timeField) {
                    timeField.value = tabTimeData[i] ? tabTimeData[i].join(',') : '';
                }
            }
        }

        function validateEmail(email) {
            if (!email) {
                return true;
            }
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(String(email).toLowerCase());
        }

        function validateTabFields(tabIndex) {
            if (tabIndex === 0) { // Assuming the first tab has personal info fields
                const requiredFields = document.querySelectorAll('#tab0 input[required]');
                for (let field of requiredFields) {
                    if (!field.value) {
                        showModal('Please fill in all required fields.');
                        field.focus();
                        return false;
                    }
                }
                const emailField = document.getElementById('email');
                if (emailField && !validateEmail(emailField.value)) {
                    showModal('The email you provided is not valid.');
                    emailField.focus();
                    return false;
                }
            }
            return true;
        }

        function changeTab(current, move) {
            // Validate current tab fields before moving
            if (move === 1 && !validateTabFields(current)) {
                return; // Prevent tab change if validation fails
            }

            // Record time spent on the current tab
            recordTimeSpent(current);

            // Store time data before moving to the next tab
            storeTimeData();

            // Change tab visibility
            document.getElementById("tab" + current).classList.remove("visible");
            document.getElementById("tab" + (current + move)).classList.add("visible");
            window.scrollTo(0, 0);
        }

        function showModal(message) {
            const modal = document.getElementById("myModal");
            const modalMessage = document.getElementById("modalMessage");
            const span = document.getElementsByClassName("close")[0];

            modalMessage.innerText = message;
            modal.style.display = "block";

            span.onclick = function() {
                modal.style.display = "none";
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }

        function getClientInfo() {
            // Step 1: Get the IP address using ipify
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                // Put the IP address into the hidden field
                document.getElementById('ip-address').value = data.ip;

                // Step 2: Use the IP address to get the country information from ipinfo
                const ip = data.ip;
                fetch(`https://ipinfo.io/${ip}/json?token=2373b6007f7705`)
                    .then(response => response.json())
                    .then(data => {
                    // Put the country into the hidden field
                    document.getElementById('country').value = data.country;
                    })
                    .catch(error => {
                    // Put the error message into the hidden country field
                    document.getElementById('country').value = 'Error fetching country information';
                    });
                })
                .catch(error => {
                // Put the error message into the hidden IP field
                document.getElementById('ip-address').value = 'Error fetching IP address';
                });
        }

        window.mobileAndTabletCheck = function() {
            let check = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
            return check;
        };

        function isMobile() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            return (/android|iphone|ipad|ipod|windows phone/i.test(userAgent) || window.innerWidth <= 767);
        }

        window.onload = function() {
            displayTabs();
            addHighlightListeners();
            getClientInfo();
        }

        function displayTabs(initially = true) {
            const container = document.getElementById("tabContainer");
            if (initially) {
                container.innerHTML = createIntroTab();
            } else {
                const firstChild = container.firstElementChild;
                if (!firstChild) {
                    console.log(`No child elements found in the container with ID '${divId}'.`);
                    return;
                }

                // Remove all children except the first one
                while (container.lastElementChild !== firstChild) {
                    console.log('Removing child:', container.lastElementChild);
                    container.removeChild(container.lastElementChild);
                }
            }
            shuffleArray(tabInfo);
            const imageKeys = Object.keys(image_data);
            shuffleArray(imageKeys);
            for (let i = 1; i < 3; i++) {
                const template = document.createElement('template');
                template.innerHTML = createTabContent(i*2-1, imageKeys.slice((i - 1) * 3, i * 3), true);
                container.appendChild(template.content);
                template.innerHTML = createTabContent(i*2, imageKeys.slice((i - 1) * 3, i * 3), false);
                container.appendChild(template.content);
            }
            const template = document.createElement('template');
            template.innerHTML = createOutroTab(5);
            container.appendChild(template.content);
            // // changeTab(0, 0);
            attachScrollToNextItem();

            const modal = document.getElementById("myModal");
            const span = document.getElementsByClassName("close")[0];

            span.onclick = function() {
                modal.style.display = "none";
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

            tabEnterTime = new Date().getTime();  // Initialize the first tab entry time
        }
    </script>
    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p id="modalMessage"></p>
        </div>
    </div>
</body>
</html>
